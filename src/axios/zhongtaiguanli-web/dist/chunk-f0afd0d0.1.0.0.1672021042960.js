(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f0afd0d0"],{"28a5":function(e,t,r){"use strict";var n=r("aae3"),a=r("cb7c"),s=r("ebd6"),i=r("0390"),o=r("9def"),u=r("5f1b"),c=r("520a"),p=r("79e5"),l=Math.min,d=[].push,h="split",m="length",f="lastIndex",b=4294967295,v=!p((function(){RegExp(b,"y")}));r("214f")("split",2,(function(e,t,r,p){var y;return y="c"=="abbc"[h](/(b)*/)[1]||4!="test"[h](/(?:)/,-1)[m]||2!="ab"[h](/(?:ab)*/)[m]||4!="."[h](/(.?)(.?)/)[m]||"."[h](/()()/)[m]>1||""[h](/.?/)[m]?function(e,t){var a=String(this);if(void 0===e&&0===t)return[];if(!n(e))return r.call(a,e,t);var s,i,o,u=[],p=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,h=void 0===t?b:t>>>0,v=new RegExp(e.source,p+"g");while(s=c.call(v,a)){if(i=v[f],i>l&&(u.push(a.slice(l,s.index)),s[m]>1&&s.index<a[m]&&d.apply(u,s.slice(1)),o=s[0][m],l=i,u[m]>=h))break;v[f]===s.index&&v[f]++}return l===a[m]?!o&&v.test("")||u.push(""):u.push(a.slice(l)),u[m]>h?u.slice(0,h):u}:"0"[h](void 0,0)[m]?function(e,t){return void 0===e&&0===t?[]:r.call(this,e,t)}:r,[function(r,n){var a=e(this),s=void 0==r?void 0:r[t];return void 0!==s?s.call(r,a,n):y.call(String(a),r,n)},function(e,t){var n=p(y,e,this,t,y!==r);if(n.done)return n.value;var c=a(e),d=String(this),h=s(c,RegExp),m=c.unicode,f=(c.ignoreCase?"i":"")+(c.multiline?"m":"")+(c.unicode?"u":"")+(v?"y":"g"),g=new h(v?c:"^(?:"+c.source+")",f),A=void 0===t?b:t>>>0;if(0===A)return[];if(0===d.length)return null===u(g,d)?[d]:[];var w=0,k=0,x=[];while(k<d.length){g.lastIndex=v?k:0;var C,$=u(g,v?d:d.slice(k));if(null===$||(C=l(o(g.lastIndex+(v?0:k)),d.length))===w)k=i(d,k,m);else{if(x.push(d.slice(w,k)),x.length===A)return x;for(var _=1;_<=$.length-1;_++)if(x.push($[_]),x.length===A)return x;k=w=C}}return x.push(d.slice(w)),x}]}))},"4e0b":function(e,t,r){"use strict";function n(e,t){return function(r,n,a){n||a(),e.test(n)?a():a(new Error(t))}}r.d(t,"a",(function(){return a})),r.d(t,"d",(function(){return s})),r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return o}));n(/^[\u4e00-\u9fa5]{0,}$/g,"只能输入汉字"),n(/^[\u4E00-\u9FA5]+(·[\u4E00-\u9FA5]+)*$/,"输入的姓名格式错误");var a=n(/^1\d{10}$/,"输入的手机号码格式错误"),s=(n(/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/,"输入的身份证号码格式错误"),n(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/,"输入的邮箱格式有误"),n(/^[a-zA-Z0-9_]{4,16}$/,"用户名格式错误,请输入4-16位字母或数字")),i=n(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[0-9a-zA-Z]{8,16}$/,"密码格式为8-16位，至少包含大小写字母和数字"),o=n(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[^]{8,16}$/,"密码格式为8-16位包含字母大小写和数字");n(/^((https?|ftp|file):\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/,"URL格式错误"),n(/^\d+$/,"只能输入数字"),n(/^-?\d+$/,"只能输入正数"),n(/^-\d+$/,"只能输入负数"),n(/^\d+$/,"只能输入整数"),n(/^-?\d+$/,"只能输入正整数"),n(/^-\d+$/,"只能输入负整数")},"5cc0":function(e,t,r){"use strict";r("f2a7")},d56f:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page"},[r("div",{staticClass:"step"},e._l(e.steps,(function(t,n){return r("div",{key:n,staticClass:"step-item",class:{active:e.stepActive===n},attrs:{"data-rank":n+1}},[e._v(e._s(t))])})),0),r("div",{staticClass:"content"},[0===e.stepActive?r("el-form",{ref:"userForm",attrs:{model:e.userForm,"label-width":"80px",rules:e.userRules}},[r("el-form-item",{attrs:{label:"账号",required:"",prop:"adminName"}},[r("el-input",{model:{value:e.userForm.adminName,callback:function(t){e.$set(e.userForm,"adminName",t)},expression:"userForm.adminName"}})],1),r("el-form-item",{attrs:{label:"密码",required:"",prop:"password"}},[r("el-input",{attrs:{disabled:""},model:{value:e.userForm.password,callback:function(t){e.$set(e.userForm,"password",t)},expression:"userForm.password"}})],1),r("el-form-item",{attrs:{label:"真实姓名",required:"",prop:"realname"}},[r("el-input",{model:{value:e.userForm.realname,callback:function(t){e.$set(e.userForm,"realname",t)},expression:"userForm.realname"}})],1),r("el-form-item",{attrs:{label:"手机号",required:"",prop:"phone"}},[r("el-input",{model:{value:e.userForm.phone,callback:function(t){e.$set(e.userForm,"phone",t)},expression:"userForm.phone"}})],1),r("el-form-item",{attrs:{label:"邮箱",required:"",prop:"email"}},[r("el-input",{model:{value:e.userForm.email,callback:function(t){e.$set(e.userForm,"email",t)},expression:"userForm.email"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onSave}},[e._v("保存并下一步")])],1)],1):e._e(),1===e.stepActive?r("el-form",{ref:"authForm",attrs:{"label-width":"80px"}},[r("el-form-item",{attrs:{label:""}},[r("el-tree",{ref:"AuthTree",attrs:{data:e.AuthTree,props:e.treeProps,"show-checkbox":"","node-key":"id","default-expand-all":""}})],1),r("el-form-item",{attrs:{label:"选择APP"}},[r("el-select",{staticClass:"app-control",attrs:{placeholder:"请选择",filterable:""},on:{change:e.onChangeApp},scopedSlots:e._u([{key:"prefix",fn:function(){return[r("span",{staticClass:"iconfont",class:e.systemIcon})]},proxy:!0}],null,!1,2869138780),model:{value:e.currentApp,callback:function(t){e.currentApp=t},expression:"currentApp"}},e._l(e.app,(function(t){return r("el-option",{key:t.id,attrs:{value:t.id,label:t.title}},[r("span",{staticClass:"iconfont",class:e.formatSystem(t.system)},[e._v(e._s(t.title)+e._s(1===t.type?"(已分配权限)":""))])])})),1)],1),r("el-form-item",[r("el-tree",{ref:"AppAuthTree",attrs:{data:e.AppAuthTree,props:e.treeProps,"show-checkbox":"","node-key":"id","default-expand-all":""}})],1),r("el-form-item",{staticClass:"operate"},[r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onSubmitAuth}},[e._v("保存至当前APP")]),r("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.showCopy=!0}}},[e._v("保存并复制当前权限到其他APP")]),r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onToThreeStep}},[e._v("下一步")])],1)],1):e._e(),2===e.stepActive?r("div",{staticClass:"account-info"},[r("div",{staticClass:"tip"},[e._v("请复制账号密码交付用户，并提醒用户及时登录修改密码。")]),r("div",{staticClass:"copy-password"},[r("el-input",{ref:"copyInput",attrs:{type:"textarea",rows:"5",value:e.accountInfo,readonly:""}}),r("div",[r("el-button",{staticClass:"copy-btn",attrs:{type:"primary",size:"small"},on:{click:e.onCopy}},[e._v("复制")])],1)],1)]):e._e()],1),r("el-dialog",{attrs:{visible:e.showCopy,title:"请选择"},on:{"update:visible":function(t){e.showCopy=t}}},[r("el-select",{staticClass:"copy-control",attrs:{placeholder:"请选择",multiple:"",filterable:""},model:{value:e.copyApp,callback:function(t){e.copyApp=t},expression:"copyApp"}},e._l(e.app,(function(t){return r("el-option",{key:t.id,attrs:{value:t.id,label:t.title}},[r("span",{staticClass:"iconfont",class:e.formatSystem(t.system)},[e._v(e._s(t.title)+e._s(1===t.type?"(已分配权限)":""))])])})),1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("div",{staticClass:"option-item"},[r("el-button",{attrs:{type:"primary"},on:{click:e.onCopyAll}},[e._v("全选")]),r("el-button",{attrs:{type:"danger"},on:{click:function(t){e.copyApp=[]}}},[e._v("清空")])],1),r("div",{staticClass:"option-item"},[r("el-button",{attrs:{type:"primary",loading:e.btnLoading},on:{click:e.onSubmitCopyAuth}},[e._v("保 存")]),r("el-button",{on:{click:function(t){e.showCopy=!1}}},[e._v("取 消")])],1)])],1)],1)},a=[],s=(r("8e6e"),r("456d"),r("c5f6"),r("ac6a"),r("28a5"),r("ade3")),i=r("3835"),o=(r("96cf"),r("1da1")),u=(r("7514"),r("a3be")),c=r("4e0b");function p(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?p(Object(r),!0).forEach((function(t){Object(s["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d={data:function(){return{steps:["填写用户信息","编辑权限信息","获取账号密码"],stepActive:0,userForm:{adminName:"",password:"",realname:"",phone:"",email:""},userRules:{adminName:[{validator:c["d"],trigger:"blur"},{required:!0,message:"请输入账号"}],password:[{validator:c["b"],trigger:"blur"},{required:!0,message:"请输入密码"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"},{required:!0,message:"请输入邮箱"}],realname:[{required:!0,message:"请输入真实姓名"}],phone:[{validator:c["a"],trigger:"blur"},{required:!0,message:"请输入手机号"}]},currentApp:"",AuthTree:[],AppAuthTree:[],treeProps:{children:"children",label:"name"},showCopy:!1,copyApp:[],app:[],adminId:"",loading:!1,accountInfo:"",authSaved:!1,btnLoading:!1}},mounted:function(){this.userForm.password=this.randomPassword(16)},computed:{systemIcon:function(e){var t=e.app,r=e.currentApp,n=_.find(t,(function(e){return e.id===r}));return n?this.formatSystem(n.system):""}},methods:{onSave:function(){var e=this;this.$refs["userForm"].validate(function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(r,n){var a,s,o,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return",!1);case 2:return t.next=4,e.$http.post(u["a"].admin.edit,l({},e.userForm));case 4:if(a=t.sent,s=Object(i["a"])(a,2),o=s[0],c=s[1],!o){t.next=10;break}return t.abrupt("return");case 10:e.$message({message:"创建成功，请分配权限",type:"success"}),e.accountInfo="中台地址：https://madmin.nineton.cn，账号：".concat(e.userForm.adminName,"，密码：").concat(e.userForm.password,"\n中台chrome插件使用：https://shimo.im/docs/zdkyB4zM44iYgPA6"),e.stepActive=1,e.adminId=c.adminId,e.fetchApp();case 15:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())},fetchApp:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.adminId,t){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.$http.post(u["a"].admin.app,{adminId:t});case 5:if(r=e.sent,n=Object(i["a"])(r,2),a=n[0],s=n[1],!a){e.next=11;break}return e.abrupt("return");case 11:this.app=s,s.length&&(this.currentApp=s[0].id,this.fetchAuth());case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),fetchMenu:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.currentApp,t){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.$http.post(u["a"].admin.menu,{appId:t});case 5:if(r=e.sent,n=Object(i["a"])(r,2),a=n[0],s=n[1],!a){e.next=11;break}return e.abrupt("return");case 11:this.AuthTree=s.splice(0,s.length-1),this.AppAuthTree=s.splice(s.length-1,s.length);case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),fetchAuth:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,s,o,c,p,l,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.currentApp,r=this.adminId,t){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.fetchMenu();case 5:return e.next=7,this.$http.post(u["a"].admin.auth_detail,{appId:t,adminId:r});case 7:if(n=e.sent,a=Object(i["a"])(n,2),s=a[0],o=a[1],!s){e.next=13;break}return e.abrupt("return");case 13:c=o.adminAuth,p=void 0===c?"":c,l=o.authArr,d=void 0===l?"":l,this.$refs["AuthTree"].setCheckedKeys(p.split(",")),this.$refs["AppAuthTree"].setCheckedKeys(d.split(","));case 16:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onSubmitAuth:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,o,c,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.currentApp,r=this.adminId,n=this.$refs["AuthTree"].getCheckedKeys().join(","),a=this.$refs["AppAuthTree"].getCheckedKeys().join(","),t){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this.$http.post(u["a"].admin.edit_auth,{appId:t,adminId:r,adminAuth:n,authArr:Object(s["a"])({},t,a)});case 7:if(o=e.sent,c=Object(i["a"])(o,2),p=c[0],c[1],!p){e.next=13;break}return e.abrupt("return");case 13:this.authSaved=!0,this.$message({message:"保存权限成功",type:"success"}),this.fetchApp();case 16:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onChangeApp:function(e){this.currentApp=e,this.$refs["AppAuthTree"].setCheckedKeys([]),this.fetchAuth()},onSubmitCopyAuth:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t,r,n,a,o,c,p,d,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.currentApp,r=this.adminId,n=this.copyApp,this.btnLoading=!0,a=this.$refs["AuthTree"].getCheckedKeys().join(","),o=this.$refs["AppAuthTree"].getCheckedKeys().join(","),t){e.next=6;break}return e.abrupt("return");case 6:return c={},n.forEach((function(e){c[e]=o})),e.next=10,this.$http.post(u["a"].admin.edit_auth,{appId:t,adminId:r,adminAuth:a,authArr:l(Object(s["a"])({},t,o),c)});case 10:if(p=e.sent,d=Object(i["a"])(p,2),h=d[0],d[1],!h){e.next=16;break}return e.abrupt("return");case 16:this.$message({message:"保存成功",type:"success"}),this.authSaved=!0,this.btnLoading=!1,this.copyApp=[],this.showCopy=!1,this.fetchApp();case 22:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onCopyAll:function(){this.copyApp=this.app.map((function(e){return e.id}))},formatSystem:function(e){switch(String(e)){case"1":return"icon-anzhuo";case"2":return"icon-ios";case"3":return"icon-weixin";case"4":return"icon-baidu";case"5":return"icon-chrome";default:return""}},randomPassword:function(e){e=Number(e),e<6?e=6:e>16&&(e=16);for(var t=["ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz","1234567890"],r=[],n=0,a=0;a<e;a++)if(r.length<e-3){var s=Math.floor(3*Math.random()),i=t[s],o=i[Math.floor(Math.random()*i.length)];r.push(o)}else{var u=t[n],c=u[Math.floor(Math.random()*u.length)],p=Math.floor(Math.random()*r.length);r.splice(p,0,c),n++}return r.join("")},onCopy:function(){this.$refs["copyInput"].select(),document.execCommand("Copy"),this.$message({message:"复制成功",type:"success"})},onToThreeStep:function(){this.authSaved?this.stepActive=2:this.$message({message:"还未保存该用户的APP权限。请保存后再进行下一步",type:"warning"})}}},h=d,m=(r("5cc0"),r("2877")),f=Object(m["a"])(h,n,a,!1,null,"db59f2c0",null);t["default"]=f.exports},f2a7:function(e,t,r){}}]);
//# sourceMappingURL=chunk-f0afd0d0.1.0.0.1672021042960.js.map